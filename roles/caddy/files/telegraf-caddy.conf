[[inputs.prometheus]]
  urls = ["http://localhost:2020/metrics"]
  tagexclude = ["url"]
  # to distinguish which series is from which container
  [inputs.prometheus.tags]
    label = "caddy"

# https://github.com/caddyserver/caddy/issues/4016
[[processors.starlark]]
  namepass = ['caddy*']
  source = """
renames = {
   'srv0': 'metrics',
   'srv1': 'freshrss',
   'srv2': 'auth',
   'srv3': 'grafana',
   'srv4': 'finance',
   'srv5': 'miniflux',
}

def apply(metric):
   k = 'server'
   if k in metric.tags:
     v = metric.tags[k]
     if v in renames:
        metric.tags[k] = renames[v]
   return metric
"""

[[outputs.influxdb_v2]]
  ## The URLs of the InfluxDB cluster nodes.
  ##
  ## Multiple URLs can be specified for a single cluster, only ONE of the
  ## urls will be written to each interval.
  ## urls exp: http://127.0.0.1:8086
  urls = ["http://localhost:8086"]

  ## Token for authentication.
  token = "{{ telegraf_influxdb_token }}"

  ## Organization is the name of the organization you wish to write to; must exist.
  organization = "home"

  ## Destination bucket to write into.
  bucket = "default"
  namepass = [ "caddy*" ]
